<div class="main">
  パンクズリスト <%= @item.category.name %>
  <div class="container">
    <div class="posts-show-item">
      <div class="post-item-name">
        <h2><%= @item.title %></h2>
      </div>
      <%= image_tag @item.image.url %>
      <div class="post-right-body">
        <h3>商品情報</h3>
        <table>
          <tbody>
            <tr>
              <th>説明</th>
              <td><%= @item.content %></td>
            </tr>
            <tr>
              <th>参考価格</th>
              <td><%= @item.price %>円</td>
            </tr>
            <tr>
              <th>内容量</th>
              <td><%= @item.gram %>cal</td>
            </tr>
            <tr>
              <th>カロリー</th>
              <td><%= @item.calorie %>cal</td>
            </tr>
            <tr>
              <th>メーカー</th>
              <td><%= @item.manufacturer.name %></td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <% if Like.find_by(user_id: @current_user.id, item_id: @item.id) %>
        <%= link_to("/likes/#{@item.id}/destroy", {method: "post"}) do %>
          <span class="fa fa-heart like-btn-unlike"></span>
        <% end %>
      <% else %>
        <%= link_to("/likes/#{@item.id}/create", {method: "post"}) do %>
          <span class="fa fa-heart like-btn"></span>
        <% end %>
      <% end %>
      <%= Like.where(item_id: @item.id).count %>
      <div class="post-menus">
        <%= link_to("編集", edit_item_path) %>
        <%= link_to("削除", @item, {method: "delete"}) %>
      </div>
    </div>
    
    <!-- ここからReview -->
    <div class="review-start">
      <h3>この商品のレビュー <%= @reviews.count %>件</h3>
    </div>
     <% @reviews.each do |review| %>
    <div class="posts-show-review">
     
      <div class="posts-review-user-left">
        <%= image_tag User.find(review.user_id).image.url %>
      </div>
      
      <div class="posts-review-user-right">
        <div class="user-name">
          <%= User.find(review.user_id).name %>
        </div>
        
        <div class="review-time">
          <%= review.created_at.strftime("%Y年%m月%d日 %H:%M") %>
        </div>
        
        <% if review.score < 3 %>
          <div class="rate rate2-5"></div>
          <div class="score"><%= review.score %></div>
        <% end %>
      </div>
      
      <div class="posts-review-content">
        <p><%= review.content %></p>
        <%= image_tag review.image.url %>
      </div>
      
      <div class="posts-end-area">
        
        <% if Like.find_by(user_id: @current_user.id, item_id: @item.id) %>
          <%= link_to("/likes/#{@item.id}/destroy", {method: "post"}) do %>
            <span class="fa fa-heart like-btn-unlike">いいね！</span>
          <% end %>
        <% else %>
          <%= link_to("/likes/#{@item.id}/create", {method: "post"}) do %>
            <span class="fa fa-heart like-btn">いいね！</span>
          <% end %>
        <% end %>
        <%= Like.where(item_id: @item.id).count %>
        <span class="fas fa-comment"><%= link_to("コメントする", "/comments/new", remote: true) %></span>
        <div class="post-menus">
          <%= link_to("編集", edit_item_path) %>
          <%= link_to("削除", @item, {method: "delete"}) %>
        </div>
      </div>
        <div id="click" class="comment-form hidden">
          <%= form_with(url: "/comments/#{Review.find_by(item_id: @item.id).id}/create" , model: Comment.new) do |form| %>
            <p>コメント</p>
            <%= form.text_field :content %>
            <%= form.submit value="決定" %>
          <% end %>
        </div>
        
        <% Comment.where(review_id: 1).each do |comment| %>
        <div class="show-comments">
          <div class="comments-user-image">
            <%= image_tag User.find(Review.find_by(item_id: @item.id).user_id).image.url %>
          </div>
          <div class="comments-user-right">
            <div class="comments-user-name">
              <%= User.find(Review.find_by(item_id: @item.id).user_id).name %>
            </div>
            <div class="comments-time">
              <%= Review.find_by(item_id: @item.id).created_at.strftime("%Y年%m月%d日 %H:%M") %>
            </div>
          </div>
            <p><%= comment.content %></p>
        </div>
        <% end %>
        
        <% if @comment %>
          <div class="show-comments">
            <div class="comments-user-image">
              <%= image_tag User.find(Review.find_by(item_id: @item.id).user_id).image.url %>
            </div>
            <div class="comments-user-right">
              <div class="comments-user-name">
                <%= User.find(Review.find_by(item_id: @item.id).user_id).name %>
              </div>
              <div class="comments-time">
                <%= Review.find_by(item_id: @item.id).created_at.strftime("%Y年%m月%d日 %H:%M") %>
              </div>
            </div>
            <div id="add"></div>
          </div>
        </div>
        <% end %>
        
        
        <% end %> <!-- @reviews -->
    </div>
  </div>
</div>