<% provide :title, @user.name %>
<% breadcrumb :user_show, @user %>

<div class="container">
  <div class="user-show">
    <div class="user">
      <%= image_tag @user.image.url, alt: "ユーザの画像" %>
      <h2><%= @user.name %></h2>
      <p><%= @user.email %></p>
      
      <% if @current_user.id == @user.id %>
        <%= link_to("編集", "/users/#{@user.id}/edit") %>
        <%= link_to "削除", "/users/#{@user.id}", method: :delete %>
      <% end %>
    </div>
      
    <% if @user.id != @current_user.id %>
      
      <% if @current_user.blocking?(@user) %>
        <%= link_to("ブロック解除", "/blocks/#{@user.id}", method: :delete) %>
      <% else %>
        <div class="follow-link">
          <% if @current_user.following?(@user) %>
            <%= link_to("フォロー解除", "/relationships/#{@user.id}/destroy", method: :delete, remote: true) %>
            <%= link_to("ブロック", "/blocks?user_id=#{@user.id}", method: :post) %>
          <% else %>
            <%= link_to("フォロー", "/relationships/#{@user.id}/create", method: :post, remote: true) %>
            <%= link_to("ブロック", "/blocks?user_id=#{@user.id}", method: :post) %>
          <% end %>
        </div>   
      <% end %>
    <% end %>
  </div>
  
    <ul class="user-tabs">
      <li class="active"><%= link_to "レビュー(#{@user.reviews.count})", "/users/#{@user.id}" %></li>
      <li><%= link_to("いいね!", "/users/#{@user.id}/likes") %></li>
      <li class="following-count"><%= link_to("フォロー中(#{@user.following.count})", following_user_path(@user)) %></li>
      <li class="followers-count"><%= link_to("フォロワー(#{@user.followers.count})", followers_user_path(@user)) %></li>
      <% if @user.id == @current_user.id %>
        <li class="message"><%= link_to "メッセージ", "/rooms/index" %></li>
      <% else %>
        <% if @room_id %>
          <li class="message"><%= link_to "メッセージ", "/users/#{@user.id}/room/#{@room_id}" %></li>
        <% else %>
          <li class="message"><%= link_to "メッセージ", room_create_path(user_id: @user.id), method: :post %></li>
        <% end %>
      <% end %>
      <% if @user.id == @current_user.id %>
        <li><%= link_to "ブロック中(#{@user.blocking.count})", "/users/#{@user.id}/blocking" %></li>
      <% end %>
    </ul>
    
    <div class="search-result">
      <%= render partial: "search/review", collection: @user.reviews %>
    </div>
  </div>
